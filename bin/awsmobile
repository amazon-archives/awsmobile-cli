#!/usr/bin/env node
/* 
 * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance with
 * the License. A copy of the License is located at
 *
 *     http://aws.amazon.com/apache2.0/
 *
 * or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
 * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions
 * and limitations under the License.
*/
"use strict";
const program = require('commander')
const chalk = require('chalk')

const featureCommand = require('./feature-command.js')
const mobileFeatures = require('../lib/aws-operations/mobile-features.js')

console.log()
process.on('exit', function () {
  console.log()
})

program.on('--help', function () {
  console.log()
  console.log('    # awsmobile features')
  console.log()
  for(let i = 0; i < mobileFeatures.length; i++){
    console.log('      ' + mobileFeatures[i])
  }
})


program
  .version(require('../package').version)
  .description('awsmobile cli enables easy incorporation of aws features into your project')
  .usage('<command> [options]')
  .command('init', 'initialize the current project with awsmobile features')
  .command('pull', 'pull the latest details of the awsmobile project from the cloud')
  .command('push', 'push the local changes on the awsmobile project to the cloud')
  .command('delete', 'delete the associated awsmobile project in the cloud')
  .command('publish', 'push awsmobile features to cloud and desploy frontend to S3 hosting bucket')
  .command('console', 'open the web console of the backend awsmobile project')
  .command('configure', 'edit configuration settings for the aws account or the project')  
  .command('features', 'turn on/off the awsmobile project features locally')
  .command('run', 'power command to start all components of the project with one strike')
  .command('<feature>', 'contains subcommands for the specified awsmobile feature')
  .parse(process.argv)

  
if(!program.runningCommand){
  if(program.args.length > 0){
    let featureName = program.args[0]
    if(mobileFeatures.includes(featureName)){
      featureCommand.run(featureName, process.argv)
    }else{
      program.help()
    }
  }
}
